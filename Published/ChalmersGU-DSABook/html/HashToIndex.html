
<!DOCTYPE html>




<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>9.5. Converting Objects to Table Indices &mdash; Data Structures and Algorithms</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../lib/normalize.css" type="text/css" />
    <link rel="stylesheet" href="../../../lib/JSAV.css" type="text/css" />
    <link rel="stylesheet" href="../../../lib/odsaMOD-min.css" type="text/css" />
    <link rel="stylesheet" href="../../../lib/jquery.ui.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../lib/odsaStyle-min.css" type="text/css" />
    <link rel="stylesheet" href="../../../lib/accessibility.css" type="text/css" />
    
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.4.1',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": {
        scale: "80"
      }
    });
  </script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="index" title="Data Structures and Algorithms" href="index.html" />
    <link rel="next" title="6. Bucket Hashing (optional)" href="BucketHash.html" />
    <link rel="prev" title="4. Separate Chaining" href="OpenHash.html" />

  </head>

  <body>


      <div class="header">
        
  
      <script type="text/javascript" src="../../../lib/jquery.min.js"></script>
      <script type="text/javascript" src="../../../lib/jquery.migrate.min.js"></script>
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/localforage/1.9.0/localforage.min.js"></script>
      <script type="text/javascript" src="../../../lib/accessibility.js"></script>
    <script type="text/javascript" src="../../../lib/jquery.ui.min.js"></script>
    <script type="text/javascript" src="../../../lib/jquery.transit.js"></script>
    <script type="text/javascript" src="../../../lib/raphael.js"></script>
    <script type="text/javascript" src="../../../lib/JSAV-min.js"></script>
    <script type="text/javascript" src="_static/config.js"></script>
    <script type="text/javascript" src="../../../lib/timeme-min.js"></script>
    <script type="text/javascript" src="../../../lib/odsaUtils-min.js"></script>
    <script type="text/javascript" src="../../../lib/odsaMOD-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
    <script type="text/javascript" src="../../../lib/dataStructures.js"></script>
    <script type="text/javascript" src="../../../lib/conceptMap.js"></script>

        
<a id="username-link" style="float:right;color:red;margin:10px 20px auto; display: none" class="username-link" href="Gradebook.html"></a>
<a id="login-link" style="float:right;color:red;margin:10px 20px auto" class="login-link" href="#"><Macro 'login'></a>
<div id="login-box" class="login-popup">
  <a href="#" class="close"><img src="_static/Images/close_pop.png" class="btn_close" title="Close Window" alt="Close" /></a>
  <form method="post" class="signin" action="https://#">
    <fieldset class="textbox">
      <label class="username">
        <span>Username</span>
        <input id="username" value="" type="text" autocomplete="on" placeholder="Username" tabindex="1">
      </label>
      <label class="password">
        <span>Password</span>
        <input id="password" value="" type="password" placeholder="Password" tabindex="2">
        <span><a id="forgot" href="#">Forgot your password?</a></span>
      </label>

      <p>
        <input type="submit" id="login-submit-button" value="Sign in" tabindex="3" />
      </p>
      <p>
        <input type="button" id="register-button" value="Register" tabindex="4" />
      </p>
    </fieldset>
  </form>
</div>

        
<a id="registration-link" style="float:right;color:red;margin:10px 20px auto" class="registration-link" href="#">Register</a>
<div id="registration-box" class="registration-popup ">
  <a href="#" class="close"><img src="_static/Images/close_pop.png" class="btn_close" title="Close Window" alt="Close Window" /></a>
  <form method="post" class="signin" action="https://#">
    <fieldset class="textbox">
      <div id="register_error" class="error"></div>
      <label class="username">
        <span>Username:</span>
        <input type="text" id="user" placeholder="Username" />
      </label>

      <label class="password">
        <span>Password</span>
        <input id="pass" type="password" placeholder="Password" />
      </label>

      <label class="password">
        <span>Confirm Password</span>
        <input id="rpass" type="password" placeholder="Confirm Password" />
      </label>

      <label class="email">
        <span>Email:</span>
        <input type="text" id="email" placeholder="Email">
      </label>

      <p>
        <input type="submit" id="register-submit-button" value="Register &rarr;"/>
      </p>
    </fieldset>
  </form>
</div>
<img class="leftlogo" src="_static/OpenDSALogoT64.png" alt="Logo"/><div class="title-wrapper">
          <div class="title-inbetween" style="display: table-cell; vertical-align: middle;">
            <div class="title-content">
              <h1 class="heading" ><a href="index.html">
                <span>Data Structures and Algorithms</span></a></h1>
              <h2 class="heading" ><span>Chapter 9 Hash Tables</span></h2>
            </div>
          </div>
        </div>
      </div>
      <div class="topnav">
        <p>
            <a style="float:left;color:blue;" href="../source/HashToIndex.rst.rst"
              target="_blank" rel="nofollow">Show Source | </a>&#160;&#160;
            <a class="abt" style="float:left;color:blue;" href="#" rel="nofollow">| About</a>&#160;&#160;

          
        «&#160;&#160;<a id="prevmod" href="OpenHash.html">9.<span class="section-number">4. </span>Separate Chaining</a>
        &#160;&#160;::&#160;&#160;
        <a  class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a  id="nextmod" href="BucketHash.html">9.<span class="section-number">6. </span>Bucket Hashing (optional)</a>&#160;&#160;»


        </p>
      </div>
       
      <div class="content">
        
  <script>ODSA.SETTINGS.MODULE_SECTIONS = ['hash-codes-are-not-table-indices', 'compressing-the-hash-code', 'negative-hash-codes', 'the-hash-code-never-changes'];</script><script>ODSA.SETTINGS.DISP_MOD_COMP = true;ODSA.SETTINGS.MODULE_NAME = "HashToIndex";ODSA.SETTINGS.MODULE_LONG_NAME = "Converting Objects to Table Indices";ODSA.SETTINGS.MODULE_CHAPTER = "Hash Tables"; ODSA.SETTINGS.BUILD_DATE = "2021-10-28 16:21:59"; ODSA.SETTINGS.BUILD_CMAP = true;JSAV_OPTIONS['lang']='en';JSAV_EXERCISE_OPTIONS['code']='pseudo';</script><div class="section" id="converting-objects-to-table-indices">
<h1>9.<span class="section-number">5. </span>Converting Objects to Table Indices<a class="headerlink" href="#converting-objects-to-table-indices" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hash-codes-are-not-table-indices">
<h2>9.<span class="section-number">5.1. </span>Hash codes are not table indices<a class="headerlink" href="#hash-codes-are-not-table-indices" title="Permalink to this headline">¶</a></h2>
<p>Now, we want to be able to calculate a table index for any kind of object.
How can we do this?
Most languages (including Java and Python), delegate this to the different classes themselves,
so that strings can decide how to hash strings, and x-ray images can decide how to hash x-ray images.
This is done by requiring a class to implement a hash method
(called <code class="docutils literal notranslate"><span class="pre">hashCode()</span></code> in Java, and <code class="docutils literal notranslate"><span class="pre">__hash__()</span></code> in Python).</p>
<div id="HashcodeDemo_PersonHash_code"><ul><li><a href="#HashcodeDemo_PersonHash_code_Java_Generic">Java</a></li><li><a href="#HashcodeDemo_PersonHash_code_Python">Python</a></li></ul><div id="HashcodeDemo_PersonHash_code_Java_Generic"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">firstName</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">lastName</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">firstName</span><span class="p">.</span><span class="na">hashCode</span><span class="p">()</span> <span class="o">+</span> <span class="n">lastName</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div id="HashcodeDemo_PersonHash_code_Python"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstName</span> <span class="o">=</span> <span class="n">first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastName</span> <span class="o">=</span> <span class="n">last</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Note: The function ``hash(x)`` calls ``x.__hash__()``</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstName</span><span class="p">)</span> <span class="o">+</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastName</span><span class="p">)</span>
</pre></div>
</div>
</div></div><script>$(function() {$( "#HashcodeDemo_PersonHash_code" ).tabs();});</script><p>Now, the problem is that these classes have no idea how large the internal hash table should be,
i.e., which interval <span class="math notranslate nohighlight">\(0\ldots M-1\)</span> they should return.
The solution is to divide the hash function in two:</p>
<ul class="simple">
<li><p>one that returns an integer: <span class="math notranslate nohighlight">\(0\leq h &lt; 2^{32}\)</span></p></li>
<li><p>and another that transforms (<em>compresses</em>) the hash code <span class="math notranslate nohighlight">\(h\)</span>
to an index <span class="math notranslate nohighlight">\(0\leq i&lt; M\)</span></p></li>
</ul>
<p>The first function is provided by the object class itself, and the second is
calculated by the hash table.</p>
</div>
<div class="section" id="compressing-the-hash-code">
<h2>9.<span class="section-number">5.2. </span>Compressing the hash code<a class="headerlink" href="#compressing-the-hash-code" title="Permalink to this headline">¶</a></h2>
<p>To compress a hash code <span class="math notranslate nohighlight">\(h\geq 0\)</span> into a table indes <span class="math notranslate nohighlight">\(i\)</span>,
we can take <span class="math notranslate nohighlight">\(h\)</span> modulo the array size <span class="math notranslate nohighlight">\(M\)</span>:
<span class="math notranslate nohighlight">\(i = h \; \% \; M\)</span>.
This is called <em>modular hashing</em> and is the most common compression method.</p>
<div class="section" id="negative-hash-codes">
<h3>9.<span class="section-number">5.2.1. </span>Negative hash codes<a class="headerlink" href="#negative-hash-codes" title="Permalink to this headline">¶</a></h3>
<p>However, in Java and Python, integers are signed, so the method <code class="docutils literal notranslate"><span class="pre">hashCode()</span></code> might return a negative integer.
If we take this modulo <span class="math notranslate nohighlight">\(M\)</span>, we might get a negative result. A negative index is not suitable as a table index,
so first we have to make the hash code positive.</p>
<p>One way to do this is to mask off the sign bit.
Java integers are <span class="math notranslate nohighlight">\(-2^{31}\leq h&lt;2^{31}\)</span>, so we can use <code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">&amp;</span> <span class="pre">0x7fffffff</span></code>.
(Python uses arbitrary size hash values, but it works fine to truncate them to 31 bits as we have done here).</p>
<div id="SeparateChainingHashMap_HashIndex_code"><ul><li><a href="#SeparateChainingHashMap_HashIndex_code_Java_Generic">Java</a></li><li><a href="#SeparateChainingHashMap_HashIndex_code_Python">Python</a></li></ul><div id="SeparateChainingHashMap_HashIndex_code_Java_Generic"><div class="highlight-java notranslate"><div class="highlight"><pre><span></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">hash</span><span class="p">(</span><span class="n">K</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">hashCode</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mh">0x7fffffff</span><span class="p">)</span> <span class="o">%</span> <span class="n">internalTable</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
</div><div id="SeparateChainingHashMap_HashIndex_code_Python"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7fffffff</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_internalTable</span><span class="p">)</span>
</pre></div>
</div>
</div></div><script>$(function() {$( "#SeparateChainingHashMap_HashIndex_code" ).tabs();});</script></div>
</div>
<div class="section" id="the-hash-code-never-changes">
<h2>9.<span class="section-number">5.3. </span>The hash code never changes<a class="headerlink" href="#the-hash-code-never-changes" title="Permalink to this headline">¶</a></h2>
<p>The generic hash codes should never change, because hashing must be predictable.
Therefore we don’t have to recalculate the hash code when we resize the internal table,
it is only the table indices that have to be updated.</p>
<p>One implication of this is that it’s only meaningful to calculate hash codes for
<em>immutable objects</em>, i.e., objects that don’t change (after they are initialised).
(That’s why Python allows tuples as dictionary keys, but not lists).</p>
<p>Python uses this fact to optimise their built-in hash tables by storing the hash codes together with the keys and values.
This increases the size of the table slightly, but on the other hand it ensures that hash codes are not calculated more than once.</p>
<p>In Java, the optimisation is delegated to the object classes themselves.
E.g., a Java string only calculates its hash code once and then stores it in an instance variable for immediate lookup.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      <p><span class="email_div" style="display:inline;"><a id="contact_us" class="contact" style="float:left;color:blue;" rel="nofollow" href="mailto:">Contact Us |</a><a style="float:left;color:blue;" rel="nofollow" href="../../../lib/Privacy.html" target="_blank">| Privacy |</a> <a style="float:left;color:blue;" rel="nofollow" href="../../../lib/license.html" target="_blank">| License</a></span>&#160;&#160;
      
        «&#160;&#160;<a id="prevmod1" href="OpenHash.html">9.<span class="section-number">4. </span>Separate Chaining</a>
        &#160;&#160;::&#160;&#160;
        <a  class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a  id="nextmod1" href="BucketHash.html">9.<span class="section-number">6. </span>Bucket Hashing (optional)</a>&#160;&#160;»

</p>
      </div>
      <img style="float:right;" src="_static/nsf1.gif" height="62" width="62" alt="nsf"/>


    <div class="footer">
      <p>
        <span class="email_div" style="display:inline;">
          <a id="contact_us" class="contact" style="float:left;color:blue;" rel="nofollow" href="mailto:">Contact Us |</a>
          <a id="bugreport-link" style="float:left;color:blue;" class="bugreport-link" href="#">| Report a bug</a>
        </span>
      </p>
        &copy; Copyright 2016 by OpenDSA Project Contributors and distributed under an MIT license.
      Last updated on Oct 28, 2021.
      Created using <a target="_blank" href="http://sphinx.pocoo.org/">Sphinx</a> 2.4.4.
    </div>
    
<div id="bugreport-box" class="bugreport-popup ">
  <a href="#" class="close"><img src="_static/Images/close_pop.png" class="btn_close" title="Close Window" alt="Close Window" /></a>
  <form method="post" class="report" action="https://#">
    <fieldset class="textbox">
      <div id="bug_error" class="error"></div>
      <label>
        <span>Summary*:</span>
        <input type="text" id="b_title" placeholder="Summary" />
      </label>

      <label class="os">
        <span>Operating system*:</span>
        <select id="b_os">
          <option value="windows">Windows</option>
          <option value="macos">Mac OS</option>
          <option value="linux">Linux</option>
          <option value="ios">iOS</option>
          <option value="android">Android</option>
          <option value="other">Other</option>
        </select>
      </label>

      <label class="browser">
        <span>Browser*:</span>
        <select id="b_browser">
          <option value="chrome">Chrome</option>
          <option value="safari">Safari</option>
          <option value="internetexplorer">Internet Explorer</option>
          <option value="opera">Opera</option>
          <option value="other">Other</option>
        </select>
      </label>

      <label class="description">
        <span>Description*:</span><br>
        <textarea id="b_description" rows="5" cols="25" placeholder="***BUG** Please enter: (1) a consice description of the problem. (2) steps to reproduce bug. (3) the version of your browser and operating system."></textarea>
      </label>

      <label class="screenshot">
        <span>Attach a screenshot (optional):</span>
        <input type="file" id="b_screenshot" accept="image/*" placeholder="Attach a screenshot (optional)">
      </label>

      <p>
        <input type="submit" id="bug-submit-button" value="Submit &rarr;"/>
      </p>
    </fieldset>
  </form>
</div>

  </body>
</html>